<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_idle.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>Arduino with mBlock</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            Arduino with mBlock
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">This course focuses on using an Arduino Uno with mBlock to create a product for Active Living.</div>
            <p>Getting Started</p><ul><a href="../10-Intro/10-intro.html"><li >Introduction</li></a><a href="../10-Intro/20-Arduino-Uno.html"><li >Arduino Uno</li></a><a href="../10-Intro/30-mBlock.html"><li >mBlock Basics</li></a><a href="../10-Intro/40-Basic-Setup.html"><li >Basic Setup</li></a></ul><p>Basic I/O</p><ul><a href="../20-Basic-IO/10-Blink.html"><li >Blink</li></a><a href="../20-Basic-IO/20-Challenge-1a.html"><li >Challenge 1a</li></a><a href="../20-Basic-IO/30-External-LED.html"><li >External LED</li></a><a href="../20-Basic-IO/40-Challenge-1b.html"><li >Challenge 1b</li></a><a href="../20-Basic-IO/50-Button-Input.html"><li >Digital Input</li></a><a href="../20-Basic-IO/60-Challenge-1c.html"><li >Challenge 1c</li></a><a href="../20-Basic-IO/70-Extra-Challenges.html"><li >Extra Challenges</li></a></ul><p>Analog I/O</p><ul><a href="../30-Analog-IO/10-Dimmer-Effect.html"><li >Dimmer Effect</li></a><a href="../30-Analog-IO/20-Analog-PWM.html"><li >Setting Analog PWM</li></a><a href="../30-Analog-IO/30-Challenge-2a.html"><li >Challenge 2a</li></a><a href="../30-Analog-IO/40-Smoothing-Effect.html"><li >Smoothing the Effect</li></a><a href="../30-Analog-IO/50-Challenge-2b.html"><li >Challenge 2b</li></a><a href="../30-Analog-IO/60-Analog-Input.html"><li >Analog Input</li></a><a href="../30-Analog-IO/70-Challenge-2c.html"><li >Challenge 2c</li></a><a href="../30-Analog-IO/80-Mapping-Input-to-Output.html"><li >Mapping Input to Output</li></a><a href="../30-Analog-IO/90-Challenge-2d.html"><li >Challenge 2d</li></a><a href="../30-Analog-IO/99-Extra-Challenges.html"><li >Extra Challenges</li></a></ul><p>Sensors</p><ul><a href="../40-Sensors/10-Tilt-Sensor.html"><li >Tilt Sensor</li></a><a href="../40-Sensors/15-Tilt-Counter.html"><li >Exercise 3a - Sit / Stand</li></a><a href="../40-Sensors/20-Ultrasonic-Sensor.html"><li >Ultrasonic Distance Sensor</li></a><a href="../40-Sensors/25-Ultrasonic-Exercise-Counter.html"><li >Challenge 3b - Exercise Counter</li></a><a href="../40-Sensors/30-Temperature-Sensor.html"><li >Temperature Sensor</li></a><a href="../40-Sensors/35-Overheat-Exercise.html"><li >Exercise 3c - Overheat Alert</li></a><a href="../40-Sensors/40-Heartrate-Sensor.html"><li >Heart Rate Sensor</li></a><a href="../40-Sensors/45-Heart-Monitor-Exercise.html"><li >Exercise 3d - BPM</li></a></ul><p>Actuators</p><ul><a href="../50-Actuators/10-Buzzer.html"><li >Buzzer</li></a><a href="../50-Actuators/20-Servo.html"><li >Servo</li></a><a href="../50-Actuators/30-LCD.html"><li >LCD</li></a></ul><p>Extras</p><ul><a href="../60-Extras/RFID.html"><li class="current">RFID</li></a></ul><p>Design Thinking: Active Living</p><ul><a href="../90-Design-Thinking/10-Introduction.html"><li >ALP Project Overview</li></a><a href="../90-Design-Thinking/20-Empathize.html"><li >Empathize</li></a><a href="../90-Design-Thinking/30-Define.html"><li >Define</li></a><a href="../90-Design-Thinking/40-Ideate.html"><li >Ideate</li></a><a href="../90-Design-Thinking/50-Prototype.html"><li >Prototype & Test</li></a></ul>
        </nav>
        <div id="content">
            <h2>RFID</h2>
<p>Radio-Frequency ID works using the radio portion of the electromagnetic spectrum to pass info wirelessly, but in very close range.  </p>
<p><img alt="" src="images/rfidbasic.png" /></p>
<p>It can be used to tag anything, living or non-living...</p>
<h2>Connecting the RFID Reader</h2>
<p><img alt="" src="images/wiring.png" /></p>
<table>
<tbody>
<tr>
<td width="188"><strong>Pin</strong></td>
<td width="175"><strong>Wiring to Arduino Uno</strong></td>
</tr>
<tr>
<td width="188">SDA</td>
<td width="175">Digital 10</td>
</tr>
<tr>
<td width="188">SCK</td>
<td width="175">Digital 13</td>
</tr>
<tr>
<td width="188">MOSI</td>
<td width="175">Digital 11</td>
</tr>
<tr>
<td width="188">MISO</td>
<td width="175">Digital 12</td>
</tr>
<tr>
<td width="188">IRQ</td>
<td width="175">unconnected</td>
</tr>
<tr>
<td width="188">GND</td>
<td width="175">GND</td>
</tr>
<tr>
<td width="188">RST</td>
<td width="175">Digital 9</td>
</tr>
<tr>
<td width="188">3.3V</td>
<td width="175">3.3V</td>
</tr>
</tbody>
</table>

<h2>Extracting Tag IDs</h2>
<p>Tags come in many forms, but mainly:</p>
<ul>
<li>Cards</li>
<li>Keychain Holders</li>
<li>Stickers</li>
</ul>
<p>No matter what kind, we can use the following Arduino code to extract their IDs.  You will need that to construct a <em>Database</em>.</p>
<p>Also you will need to dowload the Timer and MFRC522 (RFID protocal used by our electronics) libraries for this.</p>
<p><img alt="" src="images/timerlib.png" />
<img alt="" src="images/rfidlib.png" /></p>
<style>
pre {
  white-space: pre !important;
  overflow-y: scroll !important;
  height: 10vh !important;
}
</style>

<pre class="codehilite"><code>#include &lt;SPI.h&gt;
#include &lt;MFRC522.h&gt;
#include &lt;Timer.h&gt;

#define RST_PIN         9          // Configurable, see typical pin layout above
#define SS_PIN          10         // Configurable, see typical pin layout above

MFRC522 mfrc522(SS_PIN, RST_PIN);  // Create MFRC522 instance

Timer t;
String lastUID;

String getUID() {
  String content= &quot;&quot;;
  byte letter;
  for (byte i = 0; i &lt; mfrc522.uid.size; i++) 
  {
   //  content.concat(String(mfrc522.uid.uidByte[i] &lt; 0x10 ? &quot; 0&quot; : &quot; &quot;));
     content.concat(String(mfrc522.uid.uidByte[i], HEX));
  }
  content.toUpperCase();
  return content;
}

void setup() {
    Serial.begin(9600);     // Initialize serial communications with the PC
    while (!Serial);        // Do nothing if no serial port is opened (added for Arduinos based on ATMEGA32U4)
    SPI.begin();            // Init SPI bus
    mfrc522.PCD_Init();     // Init MFRC522
    delay(4);               // Optional delay. Some board do need more time after init to be ready, see Readme
    mfrc522.PCD_DumpVersionToSerial();  // Show details of PCD - MFRC522 Card Reader details
    Serial.println(F(&quot;Scan PICC to see UID, SAK, type, and data blocks...&quot;));
}

void loop() {
    // Reset the loop if no new card present on the sensor/reader. This saves the entire process when idle.
    if ( ! mfrc522.PICC_IsNewCardPresent()) {
        return;
    }

    // Select one of the cards
    if ( ! mfrc522.PICC_ReadCardSerial()) {
        return;
    }

  String UID = getUID();
  //Serial.println(&quot;UID = &quot; + UID + &quot;, LastUID = &quot; + lastUID);
  if (lastUID != UID || t.read() &gt; 4000) {
    Serial.println(UID);
    t.start();
  }
  lastUID = UID;

}
</code></pre>

<p>Run this code on your arduino.</p>
<p>Check the Serial Montior output...</p>
<p>You will need to copy the Tag IDs as needed in the RFID project code.</p>
<p>See "matchdb" lines in the Card Game under Steup() function.</p>
<h2>Creating a Card Game</h2>
<p>In this exercise we will match 2 cards to each other and blink a light if we have a good match.</p>
<p>You will need to create match cards, and affix RFID tags to them.  Then read the pairs, using the above code, and copy those pairs as needed in the code below - where we setup matchdb's.</p>
<p>The basic code to load is as follows:</p>
<pre class="codehilite"><code>#include &lt;SPI.h&gt;
#include &lt;MFRC522.h&gt;
#include &lt;Timer.h&gt;

#define RST_PIN         9          // Configurable, see typical pin layout above
#define SS_PIN          10         // Configurable, see typical pin layout above

MFRC522 mfrc522(SS_PIN, RST_PIN);  // Create MFRC522 instance

#define MAX_SIZE 52

String matchdb1[MAX_SIZE];
String matchdb2[MAX_SIZE];

bool isMatch(const String&amp; first, const String&amp; second) {
  int index1 = -1, index2 = -1;
  for(int i = 0; i &lt; MAX_SIZE; ++i) {
    if (matchdb1[i] == first) {
      index1 = i;
      Serial.print(&quot;Index 1 = &quot;);
      Serial.println(i);
      break;
    }
  }

  if (index1 == -1) {
    Serial.println(&quot;First card not in match DB&quot;);
    return false;
  }

  for(int i = 0; i &lt; MAX_SIZE; ++i) {
    if (matchdb2[i] == second) {
      index2 = i;
      Serial.print(&quot;Index 2 = &quot;);
      Serial.println(i);
      break;
    }
  }

  if (index2 == -1) {
    Serial.println(&quot;Second card not in match DB&quot;);
    return false;
  }

  return index1 == index2;
}

Timer t;
String lastUID;

bool inProgress;

String getUID() {
  String content= &quot;&quot;;
  byte letter;
  for (byte i = 0; i &lt; mfrc522.uid.size; i++) 
  {
   //  content.concat(String(mfrc522.uid.uidByte[i] &lt; 0x10 ? &quot; 0&quot; : &quot; &quot;));
     content.concat(String(mfrc522.uid.uidByte[i], HEX));
  }
  content.toUpperCase();
  return content;
}

void setup() {
  Serial.begin(9600);   // Initialize serial communications with the PC
  while (!Serial);    // Do nothing if no serial port is opened (added for Arduinos based on ATMEGA32U4)
  SPI.begin();      // Init SPI bus
  mfrc522.PCD_Init();   // Init MFRC522
  delay(4);       // Optional delay. Some board do need more time after init to be ready, see Readme
  mfrc522.PCD_DumpVersionToSerial();  // Show details of PCD - MFRC522 tag Reader details
  Serial.println(F(&quot;Scan PICC to see UID, SAK, type, and data blocks...&quot;));

  // Build Match Tables (up to 52 slots)
  matchdb1[0] = &quot;DEF26C7A&quot;;
  matchdb2[0] = &quot;BEE26C7A&quot;;

  matchdb1[1] = &quot;30307825&quot;;
  matchdb2[1] = &quot;80C67A3&quot;;

  inProgress = false;
}



String first, second;

void loop() {
  // Reset the loop if no new tag present on the sensor/reader. This saves the entire process when idle.
  if ( ! mfrc522.PICC_IsNewCardPresent()) {
    return;
  }

  // Select one of the tags
  if ( ! mfrc522.PICC_ReadCardSerial()) {
    return;
  }

  // Make sure it's a new Unique Tag
  String UID = getUID();
  //Serial.println(&quot;UID = &quot; + UID + &quot;, LastUID = &quot; + lastUID);
  if (lastUID != UID || t.read() &gt; 4000) {

    // Presenting First Card
    if (inProgress == false) {
      inProgress = true;
      first = UID;
      Serial.println(&quot;First = &quot; + UID);
    }

    // Presenting Second Card, check match
    else {
      second = UID;
      Serial.println(&quot;Second = &quot; + UID);
      if (isMatch(first,second)) {
        Serial.println(&quot;MATCH!&quot;);
        // Blink Light
        digitalWrite(2, HIGH);
        delay(1);
        digitalWrite(2, LOW);
        delay(1);
      } 
      else {
        Serial.println(&quot;NO MATCH...&quot;);  
      }
      inProgress = false;
      first = second = &quot;&quot;;
    }
    lastUID = UID;

    Serial.println(UID);
    t.start();


  }

}
</code></pre>
        </div>
        <button type="button" id="hamburger"><i class="fa fa-bars"></i></button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });

            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        });
    </script>
</body>
</html>