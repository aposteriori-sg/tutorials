<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_idle.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>Internet of Things</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            Internet of Things
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">This course focuses on using an IoT development board with to create a smart, interconnected device.</div>
            <p>Getting Started</p><ul><a href="../10-Introduction/10-Course-Overview.html"><li >Course Overview</li></a><a href="../10-Introduction/20-Simulated-Environment.html"><li >IoT Simulation</li></a></ul><p>Getting Real</p><ul><a href="../20-Getting-Real/10-Hello-World.html"><li >Using Real Electronics</li></a><a href="../20-Getting-Real/20-Blynk-Blink.html"><li >Blynk Blink</li></a><a href="../20-Getting-Real/30-RGB-Strip---Introduction.html"><li >RGB Strip - Introduction</li></a><a href="../20-Getting-Real/40-RGB-Strip---Coding.html"><li class="current">RGB Strip - Coding</li></a><a href="../20-Getting-Real/50-RGB-Strip---Challenges.html"><li >RGB Strip - Challenges</li></a></ul>
        </nav>
        <div id="content">
            <h2>RGB Strip - Coding</h2>
<p>Not all electronics have a simple ON/OFF or corralating Widget in Blynk.  This is one example that cannot be easily supported with just running Blynk.  We will need to add some more complex coding.</p>
<h3>RGB Strip API Library</h3>
<p>First, let's find a suitable library to support controlling the RGB Strip. </p>
<p>It has some electronic communication protocol that is simple enough, but we won't be coding it from scratch!</p>
<p>In Arduino, go to <em>Tools -&gt; Library Manager</em> and install Adafruit NeoPixel library (latest version):
<img alt="" src="images/neopixel.jpg" /></p>
<h3>Test RGB Strip Control</h3>
<p>First, let's just make sure that we can control the RGB Strip without Blynk.</p>
<p>Add the following to the top of your basic Blynk sketch:</p>
<pre class="codehilite"><code>#include &lt;Adafruit_NeoPixel.h&gt;
</code></pre>

<p>Now, let's define our RGB Strip anywhere between that line above and the setup() function:</p>
<pre class="codehilite"><code>Adafruit_NeoPixel strip(6, 5, NEO_GRB + NEO_KHZ800);
</code></pre>

<p>This defines a 6-LED RGB Strip, contrlled by ESP32's PIN 5.</p>
<p>In Setup() function, add the following code:</p>
<pre class="codehilite"><code>// Define red color
uint32_t red = strip.Color(255, 0, 0);  // HIGH red, no green, no blue

// Cycle through all 6 LEDs
for(int c=0; c &lt; strip.numPixels(); c += 1) {
  // Set pixel 'c' to red
  strip.setPixelColor(c, red); 
}

// Now show the contents of the different LEDs as defined above
strip.show();
</code></pre>

<p>Compile &amp; Upload (see below) to get the LED strip to turn on.</p>
<p>If you can't get your LED's to turn on please make sure the pins are connected properly, the code compiles without errors, and that the upload is successful before getting help.</p>
<h3>Intercepting V0 Messages from Blynk</h3>
<p>If you managed to control the RGB Strip and turn it some color (you can change the value of the color from red to something else using different RGB values), it's time to ty to control it from Blynk.</p>
<p>We will need to add an intercepting code for when Blynk tries to write some new RGB values to the board:</p>
<p>The code this extra function is as follows:</p>
<pre class="codehilite"><code>BLYNK_WRITE(V0)
{

  int R = param[0].asInt();
  int G = param[1].asInt();
  int B = param[2].asInt();

  uint32_t color = strip.Color(R,G,B); 
  for(int c=0; c &lt; strip.numPixels(); c += 1) {

  // Set pixel 'c' to color
  strip.setPixelColor(c, color);

  // Now show the contents of the different LEDs as defined above
  strip.show(); 
}
</code></pre>

<h2>Compile &amp; Upload</h2>
<p>Next, compile the program to make sure you followed the above instructions properly:</p>
<p><img alt="" src="images/compile.jpg" /></p>
<p>It will ask you to save the file if you haven't yet.  You can call it whatever you want...</p>
<p>If there are no errors, proceed.
If there are errors, see if you can fix them on your own, and if not, call an instructor to help you.</p>
<p>Finally, it's time to upload the program:</p>
<p><img alt="" src="images/upload.jpg" /></p>
<p><strong>IMPORTANT NOTE - BOOT MODE</strong></p>
<p>Every time you Upload a program to the ESP32, you have to click and hold the small Boot button next to the mini-USB connector.</p>
<p><img alt="" src="images/boot.jpg" /></p>
<p><em>The buttons may be labelled differently on your board, but it should be the same side as shown here.</em></p>
<p>This puts the board into programming mode.</p>
<p>Hold the button until the Arduino log says it passed the connection part:</p>
<pre class="codehilite"><code>Connecting........___   &lt;----
Chip is ESP32-D0WDQ6 (revision 1)

...
&lt;bunch of other logs&gt;
...

Leaving...
Hard resetting via RTS pin...
</code></pre>

<h2>Test</h2>
<p>So now you should be able to change the color of the LEDs on the strip by running your Blynk dasshboard and choosing different colors from the zeRGBa widget!</p>
<p>Use all you've learned to make sure you've done everything right before getting help.</p>
        </div>
        <button type="button" id="hamburger"><i class="fa fa-bars"></i></button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });

            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        });
    </script>
</body>
</html>